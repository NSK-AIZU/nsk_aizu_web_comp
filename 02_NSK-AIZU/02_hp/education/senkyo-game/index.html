<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>選挙の達人 2026</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Noto Sans JP', sans-serif; }
        body { background: #f5f5f5; color: #333; line-height: 1.6; }

        /* Layout */
        .container { max-width: 800px; margin: 0 auto; padding: 20px; }
        header { background: #1a365d; color: #fff; padding: 24px 0; text-align: center; }
        header h1 { font-size: 24px; font-weight: 700; }
        header p { font-size: 14px; opacity: 0.8; margin-top: 4px; }

        /* Navigation */
        nav { background: #fff; border-bottom: 1px solid #ddd; position: sticky; top: 0; z-index: 100; }
        nav ul { display: flex; list-style: none; max-width: 800px; margin: 0 auto; }
        nav li { flex: 1; }
        nav button { width: 100%; padding: 14px; border: none; background: none; font-size: 14px; font-weight: 500; color: #666; cursor: pointer; border-bottom: 2px solid transparent; }
        nav button:hover { background: #f9f9f9; }
        nav button.active { color: #1a365d; border-bottom-color: #1a365d; }

        /* Sections */
        .tab-panel { display: none; }
        .tab-panel.active { display: block; }
        section { background: #fff; border: 1px solid #ddd; margin-bottom: 16px; }
        .section-header { background: #f9f9f9; padding: 12px 16px; border-bottom: 1px solid #ddd; font-weight: 700; font-size: 15px; }
        .section-body { padding: 16px; }

        /* Forms */
        input[type="text"], input[type="number"], input[type="password"], select {
            width: 100%; padding: 10px 12px; border: 1px solid #ccc; font-size: 15px;
        }
        input:focus, select:focus { outline: none; border-color: #1a365d; }
        label { display: block; margin-bottom: 6px; font-weight: 500; font-size: 14px; }
        .help-text { font-size: 13px; color: #666; margin-top: 4px; }

        /* Party Grid */
        .party-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        @media (max-width: 600px) { .party-grid { grid-template-columns: 1fr; } }
        .party-item { display: flex; align-items: center; gap: 12px; padding: 12px; background: #f9f9f9; border-left: 4px solid #ccc; }
        .party-item .name { flex: 1; font-weight: 500; font-size: 14px; }
        .party-item input { width: 80px; text-align: center; font-weight: 700; }

        /* Total */
        .total-bar { display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; background: #f0f0f0; margin-top: 16px; }
        .total-bar .value { font-size: 20px; font-weight: 700; }
        .total-bar .status { font-size: 14px; padding: 4px 12px; border-radius: 4px; }
        .status-ok { background: #d4edda; color: #155724; }
        .status-error { background: #f8d7da; color: #721c24; }
        .status-warning { background: #fff3cd; color: #856404; }

        /* Quiz */
        .quiz-item { padding: 12px 0; border-bottom: 1px solid #eee; }
        .quiz-item:last-child { border-bottom: none; }
        .quiz-question { font-size: 14px; margin-bottom: 8px; }
        .quiz-options { display: flex; gap: 8px; }
        .quiz-btn { flex: 1; padding: 10px; border: 1px solid #ccc; background: #fff; cursor: pointer; font-size: 14px; }
        .quiz-btn:hover { background: #f5f5f5; }
        .quiz-btn.selected-yes { background: #d4edda; border-color: #28a745; }
        .quiz-btn.selected-no { background: #f8d7da; border-color: #dc3545; }

        /* Candidates */
        .candidate-item { padding: 12px; border: 1px solid #ddd; margin-bottom: 8px; cursor: pointer; display: flex; align-items: center; gap: 12px; }
        .candidate-item:hover { background: #f9f9f9; }
        .candidate-item.selected { background: #e3f2fd; border-color: #1a365d; }
        .candidate-name { font-weight: 700; }
        .candidate-party { font-size: 13px; color: #666; }
        .candidate-status { margin-left: auto; font-size: 12px; background: #eee; padding: 2px 8px; }

        /* Buttons */
        .btn { padding: 12px 24px; border: none; font-size: 15px; font-weight: 500; cursor: pointer; }
        .btn-primary { background: #1a365d; color: #fff; width: 100%; }
        .btn-primary:hover { background: #2c5282; }
        .btn-primary:disabled { background: #aaa; cursor: not-allowed; }
        .btn-secondary { background: #fff; border: 1px solid #ccc; }
        .btn-secondary:hover { background: #f5f5f5; }
        .btn-danger { background: #dc3545; color: #fff; }

        /* Modal */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 200; align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        .modal-content { background: #fff; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto; }
        .modal-header { padding: 16px; border-bottom: 1px solid #ddd; font-weight: 700; display: flex; justify-content: space-between; align-items: center; }
        .modal-body { padding: 16px; }
        .modal-footer { padding: 16px; border-top: 1px solid #ddd; display: flex; gap: 8px; justify-content: flex-end; }
        .close-btn { background: none; border: none; font-size: 24px; cursor: pointer; color: #666; }

        /* Site Navigation */
        .site-nav { background: #111; padding: 10px 0; font-size: 13px; }
        .site-nav .container { display: flex; justify-content: space-between; align-items: center; }
        .site-nav a { color: #ccc; text-decoration: none; }
        .site-nav a:hover { color: #fff; text-decoration: underline; }
        .site-nav .breadcrumb { display: flex; gap: 6px; align-items: center; }
        .site-nav .breadcrumb span { color: #666; }

        /* Participants List */
        .participant-item { padding: 12px; border: 1px solid #ddd; margin-bottom: 8px; cursor: pointer; }
        .participant-item:hover { background: #f9f9f9; }
        .participant-name { font-weight: 700; }
        .participant-time { font-size: 13px; color: #666; }
        .participant-summary { font-size: 13px; color: #1a365d; margin-top: 4px; }

        /* Detail View */
        .detail-section { margin-bottom: 16px; }
        .detail-title { font-weight: 700; font-size: 14px; margin-bottom: 8px; padding-bottom: 4px; border-bottom: 1px solid #eee; }
        .detail-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; font-size: 14px; }
        .detail-item { display: flex; justify-content: space-between; padding: 4px 0; }
        .detail-label { color: #666; }
        .detail-value { font-weight: 500; }

        /* Results */
        .result-summary { background: #1a365d; color: #fff; padding: 16px; margin-bottom: 16px; }
        .result-summary h3 { margin-bottom: 12px; }
        .result-parties { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; }
        .result-party { text-align: center; padding: 8px; background: rgba(255,255,255,0.1); }
        .result-party .name { font-size: 12px; opacity: 0.8; }
        .result-party .seats { font-size: 18px; font-weight: 700; }

        .ranking-item { display: flex; align-items: center; gap: 12px; padding: 12px; border: 1px solid #ddd; margin-bottom: 8px; }
        .ranking-rank { font-size: 20px; font-weight: 700; width: 40px; text-align: center; }
        .ranking-rank.gold { color: #d4af37; }
        .ranking-rank.silver { color: #aaa; }
        .ranking-rank.bronze { color: #cd7f32; }
        .ranking-rank.last { color: #dc3545; }
        .ranking-info { flex: 1; }
        .ranking-name { font-weight: 700; }
        .ranking-breakdown { font-size: 13px; color: #666; margin-top: 2px; }
        .ranking-score { font-size: 24px; font-weight: 700; color: #1a365d; }

        /* Pitari */
        .pitari-box { background: #fff3cd; padding: 12px 16px; margin-top: 16px; border-left: 4px solid #ffc107; }
        .pitari-title { font-weight: 700; margin-bottom: 4px; }
        .pitari-value { font-size: 18px; }

        /* Loading */
        .loading { text-align: center; padding: 40px; color: #666; }

        /* Message */
        .empty-message { text-align: center; padding: 40px; color: #666; }

        /* Current Seats Reference */
        .ref-section { background: #fff; border: 1px solid #ddd; margin-bottom: 16px; }
        .ref-header { background: #e8edf3; padding: 12px 16px; border-bottom: 1px solid #ddd; font-weight: 700; font-size: 15px; color: #1a365d; display: flex; justify-content: space-between; align-items: center; cursor: pointer; user-select: none; }
        .ref-header .toggle-icon { font-size: 12px; transition: transform 0.2s; }
        .ref-header .toggle-icon.open { transform: rotate(180deg); }
        .ref-body { padding: 16px; }
        .ref-body.collapsed { display: none; }
        .ref-note { font-size: 12px; color: #888; margin-bottom: 14px; line-height: 1.5; }
        .ref-bar-row { display: flex; align-items: center; margin-bottom: 6px; gap: 8px; }
        .ref-bar-label { width: 110px; font-size: 13px; font-weight: 500; text-align: right; flex-shrink: 0; }
        .ref-bar-track { flex: 1; background: #f0f0f0; height: 28px; position: relative; border-radius: 3px; overflow: hidden; }
        .ref-bar-fill { height: 100%; border-radius: 3px; display: flex; align-items: center; justify-content: flex-end; padding-right: 6px; transition: width 0.8s ease; min-width: 0; }
        .ref-bar-value { font-size: 12px; font-weight: 700; color: #fff; text-shadow: 0 1px 2px rgba(0,0,0,0.3); }
        .ref-bar-value-out { font-size: 12px; font-weight: 700; color: #555; margin-left: 6px; flex-shrink: 0; width: 30px; }
        .ref-total-row { display: flex; justify-content: space-between; align-items: center; padding: 10px 0 0; margin-top: 10px; border-top: 1px solid #ddd; font-size: 13px; }
        .ref-total-row .label { color: #666; }
        .ref-total-row .value { font-weight: 700; font-size: 16px; color: #1a365d; }
        .ref-coalition { display: flex; gap: 12px; margin-top: 12px; font-size: 13px; }
        .ref-coalition-item { flex: 1; background: #f9f9f9; padding: 8px 12px; border-radius: 4px; text-align: center; }
        .ref-coalition-item .c-label { color: #666; font-size: 12px; }
        .ref-coalition-item .c-value { font-weight: 700; font-size: 18px; margin-top: 2px; }
        .ref-coalition-item .c-sub { font-size: 11px; color: #999; }
        @media (max-width: 600px) { .ref-bar-label { width: 80px; font-size: 12px; } }

        /* Geolocation button */
        #geo-btn { transition: opacity 0.2s; }
        #geo-btn:hover { opacity: 0.9; }
        #geo-btn:disabled { opacity: 0.6; cursor: wait; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <!-- Confirmation Modal -->
    <div id="confirm-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                予測内容の確認
                <button class="close-btn" onclick="closeConfirmModal()">&times;</button>
            </div>
            <div class="modal-body" id="confirm-body"></div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeConfirmModal()">修正する</button>
                <button class="btn btn-primary" onclick="confirmSubmit()" style="width:auto">提出する</button>
            </div>
        </div>
    </div>

    <!-- Participant Detail Modal -->
    <div id="detail-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span id="detail-name">参加者名</span>
                <button class="close-btn" onclick="closeDetailModal()">&times;</button>
            </div>
            <div class="modal-body" id="detail-body"></div>
        </div>
    </div>


    <!-- Site Navigation -->
    <div class="site-nav">
        <div class="container breadcrumb">
            <div class="breadcrumb">
                <a href="/">NSK_AIZU</a>
                <span>›</span>
                <a href="/education/">教育支援</a>
                <span>›</span>
                <span style="color:#999;">選挙の達人</span>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header>
        <div class="container">
            <h1>選挙の達人 2026</h1>
            <p>第51回衆議院議員総選挙 予測バトル</p>
        </div>
    </header>

    <!-- Navigation -->
    <nav>
        <ul>
            <li><button id="tab-predict" class="active" onclick="showTab('predict')">予測入力</button></li>
            <li><button id="tab-participants" onclick="showTab('participants')">参加者</button></li>
            <li><button id="tab-results" onclick="showTab('results')">結果</button></li>
            <li id="admin-tab-li" style="display:none"><button id="tab-admin" onclick="showTab('admin')">管理</button></li>
        </ul>
    </nav>

    <!-- Main Content -->
    <main class="container">
        <!-- Predict Tab -->
        <div id="panel-predict" class="tab-panel active">
            <!-- Current Seats Reference -->
            <div class="ref-section">
                <div class="ref-header" onclick="toggleRef()">
                    <span>公示前の各党議席数（参考）</span>
                    <span class="toggle-icon open" id="ref-toggle">▼</span>
                </div>
                <div class="ref-body" id="ref-body">
                    <div class="ref-note">
                        解散時の各党議席数です。予測の参考にしてください。<br>
                        出典: 選挙ドットコム（定数465 / 過半数233）
                    </div>
                    <div id="ref-bars"></div>
                    <div class="ref-coalition">
                        <div class="ref-coalition-item">
                            <div class="c-label">与党（自民＋維新）</div>
                            <div class="c-value">232</div>
                            <div class="c-sub">過半数まであと1</div>
                        </div>
                        <div class="ref-coalition-item">
                            <div class="c-label">野党第一党</div>
                            <div class="c-value">167</div>
                            <div class="c-sub">中道改革連合</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Name -->
            <section>
                <div class="section-header">参加者名</div>
                <div class="section-body">
                    <input type="text" id="participant-name" placeholder="お名前を入力">
                </div>
            </section>

            <!-- Party Seats -->
            <section>
                <div class="section-header">1. 各党の獲得議席数予測（最大60点）</div>
                <div class="section-body">
                    <p class="help-text" style="margin-bottom:12px">各政党の議席数を予測してください。合計が465になるようにしてください。（）内は公示前の議席数です。</p>
                    <div id="party-inputs" class="party-grid"></div>
                    <div class="total-bar">
                        <span>合計</span>
                        <div>
                            <span id="total-seats" class="value">0</span>
                            <span> / 465</span>
                            <span id="seats-status" class="status status-warning" style="margin-left:12px">あと465</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Quiz -->
            <section>
                <div class="section-header">2. 予測クイズ（各5点 × 6問 = 最大30点）</div>
                <div class="section-body">
                    <div id="quiz-inputs"></div>
                </div>
            </section>

            <!-- Local -->
            <section>
                <div class="section-header">3. 地元枠（10点）</div>
                <div class="section-body">
                    <p class="help-text" style="margin-bottom:12px">自分の地元の選挙区を選び、当選者の名前と政党を予測してください。</p>
                    <button id="geo-btn" onclick="detectLocation()" style="width:100%;padding:10px 16px;margin-bottom:12px;background:#1a365d;color:#fff;border:none;border-radius:6px;font-size:14px;font-weight:500;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M12 2v4M12 18v4M2 12h4M18 12h4"/><circle cx="12" cy="12" r="9"/></svg>
                        現在地から選挙区を設定
                    </button>
                    <div id="geo-status" style="display:none;margin-bottom:12px;padding:8px 12px;border-radius:4px;font-size:13px"></div>
                    <div style="display:flex;gap:12px;margin-bottom:12px">
                        <div style="flex:1">
                            <label>都道府県</label>
                            <select id="local-pref" style="width:100%;padding:10px;border:1px solid #ccc;font-size:15px" onchange="updateDistrictOptions()">
                                <option value="">選択してください</option>
                            </select>
                        </div>
                        <div style="flex:1">
                            <label>選挙区</label>
                            <select id="local-district" style="width:100%;padding:10px;border:1px solid #ccc;font-size:15px" onchange="updateCandidateOptions()">
                                <option value="">先に都道府県を選択</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label>当選予測：候補者名</label>
                        <select id="local-candidate-name" style="width:100%;padding:10px;border:1px solid #ccc;font-size:15px">
                            <option value="">先に選挙区を選択してください</option>
                        </select>
                    </div>
                </div>
            </section>

            <!-- Pitari -->
            <div class="pitari-box">
                <div class="pitari-title">4. ピタリ賞ボーナス（20点）</div>
                <p class="help-text">第一党の獲得議席数をピッタリ当てると+20点</p>
                <div class="pitari-value">
                    あなたの予測：<strong id="pitari-party">-</strong> <strong id="pitari-seats">-</strong>議席
                </div>
            </div>

            <!-- Submit -->
            <div style="margin-top:20px">
                <button id="submit-btn" class="btn btn-primary" onclick="openConfirmModal()">予測を確認する</button>
            </div>
        </div>

        <!-- Participants Tab -->
        <div id="panel-participants" class="tab-panel">
            <section>
                <div class="section-header" style="display:flex;justify-content:space-between;align-items:center">
                    参加者一覧
                    <button class="btn btn-secondary" onclick="loadParticipants()" style="padding:6px 12px;font-size:13px">更新</button>
                </div>
                <div class="section-body" id="participants-list">
                    <div class="loading">読み込み中...</div>
                </div>
            </section>
        </div>

        <!-- Results Tab -->
        <div id="panel-results" class="tab-panel">
            <div id="results-container">
                <div class="empty-message">開票結果が入力されるまでお待ちください</div>
            </div>
        </div>

        <!-- Admin Tab -->
        <div id="panel-admin" class="tab-panel">
            <section>
                <div class="section-header">実際の選挙結果を入力</div>
                <div class="section-body">
                    <h4 style="margin-bottom:12px;font-size:14px">各党の獲得議席数</h4>
                    <div id="admin-party-inputs" class="party-grid"></div>
                    <div class="total-bar">
                        <span>合計</span>
                        <span id="admin-total" class="value">0</span>
                    </div>

                    <h4 style="margin:20px 0 12px;font-size:14px">クイズの正解</h4>
                    <div id="admin-quiz-inputs"></div>

                    <h4 style="margin:20px 0 12px;font-size:14px">地元枠の正解</h4>
                    <p class="help-text" style="margin-bottom:12px">参加者が選んだ選挙区の当選者を入力してください。</p>
                    <div style="margin-bottom:12px">
                        <button class="btn btn-secondary" onclick="loadAdminLocalDistricts()" style="padding:8px 16px;font-size:13px">参加者の選挙区を読み込む</button>
                    </div>
                    <div id="admin-local-inputs"></div>

                    <div style="margin-top:24px">
                        <button class="btn btn-primary" onclick="saveResults()">結果を保存して採点する</button>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
    // ============================================
    // Firebase設定
    // ============================================
    const FIREBASE_CONFIG = {
        apiKey: "AIzaSyAgm_aWPztMm7rBWW3rQa30b0oDFnJupYQ",
        authDomain: "election-prediction-2026-96efa.firebaseapp.com",
        databaseURL: "https://election-prediction-2026-96efa-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "election-prediction-2026-96efa",
        storageBucket: "election-prediction-2026-96efa.firebasestorage.app",
        messagingSenderId: "83415577371",
        appId: "1:83415577371:web:b93ed6b90df5bd017cd9be",
        measurementId: "G-3FFCM5PSFJ"
    };
    // ============================================
    // 管理者アクセス方法：
    // URLに ?admin=あなたの秘密のキー を追加してアクセス
    // 例: https://yoursite.github.io/?admin=mysecretkey
    // （コードにはキーを書かないので、URLを知っている人だけがアクセス可能）
    // ============================================

    // Data
    const PARTIES = [
        { id: 'ldp', name: '自由民主党', color: '#c62828', preSeats: 198 },
        { id: 'chudo', name: '中道改革連合', color: '#1565c0', preSeats: 167 },
        { id: 'ishin', name: '日本維新の会', color: '#2e7d32', preSeats: 34 },
        { id: 'kokumin', name: '国民民主党', color: '#ff8f00', preSeats: 27 },
        { id: 'reiwa', name: 'れいわ新選組', color: '#d81b60', preSeats: 8 },
        { id: 'jcp', name: '日本共産党', color: '#b71c1c', preSeats: 8 },
        { id: 'genzei', name: '減税日本・ゆうこく連合', color: '#00838f', preSeats: 5 },
        { id: 'sansei', name: '参政党', color: '#6a1b9a', preSeats: 2 },
        { id: 'hoshu', name: '日本保守党', color: '#4e342e', preSeats: 1 },
        { id: 'sdp', name: '社会民主党', color: '#e65100', preSeats: 1 },
        { id: 'mirai', name: 'チームみらい', color: '#00897b', preSeats: 0 },
        { id: 'other', name: 'その他・無所属', color: '#616161', preSeats: 14 }
    ];

    const QUIZZES = [
        { id: 'q1', q: '自民党は単独過半数（233議席以上）を獲得する？' },
        { id: 'q2', q: '女性当選者は50人を超える？' },
        { id: 'q3', q: '中道改革連合は100議席以上を獲得する？' },
        { id: 'q4', q: '投票率は前回（2024年）を上回る？' },
        { id: 'q5', q: '比例代表の第三位は国民民主党？' },
        { id: 'q6', q: '落選する現職大臣がいる？' }
    ];

    // Districts data: 47 prefectures with their 小選挙区 counts (total: 289)
    const DISTRICTS = [
        { pref: '北海道', count: 12 },
        { pref: '青森', count: 3 },
        { pref: '岩手', count: 3 },
        { pref: '宮城', count: 5 },
        { pref: '秋田', count: 3 },
        { pref: '山形', count: 3 },
        { pref: '福島', count: 4 },
        { pref: '茨城', count: 7 },
        { pref: '栃木', count: 5 },
        { pref: '群馬', count: 5 },
        { pref: '埼玉', count: 16 },
        { pref: '千葉', count: 14 },
        { pref: '東京', count: 30 },
        { pref: '神奈川', count: 20 },
        { pref: '新潟', count: 5 },
        { pref: '富山', count: 3 },
        { pref: '石川', count: 3 },
        { pref: '福井', count: 2 },
        { pref: '山梨', count: 2 },
        { pref: '長野', count: 5 },
        { pref: '岐阜', count: 5 },
        { pref: '静岡', count: 8 },
        { pref: '愛知', count: 16 },
        { pref: '三重', count: 4 },
        { pref: '滋賀', count: 3 },
        { pref: '京都', count: 6 },
        { pref: '大阪', count: 19 },
        { pref: '兵庫', count: 12 },
        { pref: '奈良', count: 3 },
        { pref: '和歌山', count: 2 },
        { pref: '鳥取', count: 2 },
        { pref: '島根', count: 2 },
        { pref: '岡山', count: 4 },
        { pref: '広島', count: 6 },
        { pref: '山口', count: 3 },
        { pref: '徳島', count: 2 },
        { pref: '香川', count: 3 },
        { pref: '愛媛', count: 3 },
        { pref: '高知', count: 2 },
        { pref: '福岡', count: 11 },
        { pref: '佐賀', count: 2 },
        { pref: '長崎', count: 3 },
        { pref: '熊本', count: 4 },
        { pref: '大分', count: 3 },
        { pref: '宮崎', count: 3 },
        { pref: '鹿児島', count: 4 },
        { pref: '沖縄', count: 4 }
    ];

    const CANDIDATES_DATA = {
    "北海道1区": ["道下大樹","臼木秀剛","森英士","加藤貴弘","加納千津子"],
    "北海道2区": ["平岡大介","高橋祐介","松木謙公","中田綾子","山崎泉"],
    "北海道3区": ["高木宏寿","中島良樹","円子裕子","荒井優"],
    "北海道4区": ["佐々木明美","中村裕之","大築紅葉","高橋翔太"],
    "北海道5区": ["和田義明","池田真紀"],
    "北海道6区": ["荻生和敏","西川将人","東国幹"],
    "北海道7区": ["篠田奈保子","鈴木貴子"],
    "北海道8区": ["逢坂誠二","向山淳"],
    "北海道9区": ["立野広志","松下英樹","山岡達丸","菅野望帆"],
    "北海道10区": ["渡辺孝一","神谷裕"],
    "北海道11区": ["宇都隆史","石川香織","中川紘一"],
    "北海道12区": ["武部新","川原田英世"],
    "青森1区": ["升田世喜男","斎藤美緒","加藤勉","津島淳"],
    "青森2区": ["神田潤一","金濱亨","久保将","松尾和彦"],
    "青森3区": ["岡田華子","木村次郎","佐原若子"],
    "岩手1区": ["階猛","米内紘正","吉田恭子","佐々木大成","小笠原勇治"],
    "岩手2区": ["佐々木真琴","鈴木俊一"],
    "岩手3区": ["小沢一郎","藤原崇","及川泰輔"],
    "宮城1区": ["ローレンス綾子","中嶋廉","高橋浩司","土井亨","岡本章子"],
    "宮城2区": ["和田政宗","鎌田さゆり","早坂敦","渡辺勝幸","佐藤理々香"],
    "宮城3区": ["西村明宏","林萌子","柳沢剛","結城孝","浅田晃司"],
    "宮城4区": ["佐野誠","安住淳","森下千里"],
    "宮城5区": ["境恒春","小野寺五典","結城豊"],
    "秋田1区": ["冨樫博之","木村佐知子","佐藤美和子","鈴木知","早川周作","松浦大悟"],
    "秋田2区": ["福原淳嗣","緑川貴士"],
    "秋田3区": ["御法川信英","村岡敏英"],
    "山形1区": ["遠藤寛明","原田和広","桜田恭子"],
    "山形2区": ["菊池大二郎","鈴木憲和","岩本康嗣"],
    "山形3区": ["落合拓磨","遠藤和史","加藤鮎子","喜多恒介"],
    "福島1区": ["西山尚利","亀岡偉一","金子恵美"],
    "福島2区": ["玄葉光一郎","大山里幸子","遠藤雄大","丸本由美子","根本拓"],
    "福島3区": ["上杉謙太郎","金山屯","小熊慎司"],
    "福島4区": ["山口洋太","斎藤裕喜","熊谷智","坂本竜太郎"],
    "茨城1区": ["大内久美子","川端絢美","福島伸享","田所嘉徳"],
    "茨城2区": ["宮内匠","小沼巧","額賀福志郎","谷川祐一"],
    "茨城3区": ["斎藤真衣","梶岡博樹","葉梨康弘","加川裕美"],
    "茨城4区": ["吉田翔","梶山弘志"],
    "茨城5区": ["鈴木拓海","浅野哲"],
    "茨城6区": ["稲葉英樹","青山大人","堀越麻紀","国光文乃","中村吉男"],
    "茨城7区": ["永岡桂子","中村勇太"],
    "栃木1区": ["大森紀明","青木弘","船田元","小池篤史","柏倉祐司","石川文三郎"],
    "栃木2区": ["福田昭夫","五十嵐清","藤田久美"],
    "栃木3区": ["渡辺真太朗","簗和生","伊賀央"],
    "栃木4区": ["石坂太","藤岡隆雄","野口智子","大貫学"],
    "栃木5区": ["茂木敏充","寺田和史","岡村恵子","宮本陽介"],
    "群馬1区": ["中曽根康隆","店橋世津子","河村正剛"],
    "群馬2区": ["原和隆","井野俊郎","石関貴史","高橋保","伊藤純子","熊井戸園子"],
    "群馬3区": ["長谷川嘉一","笹川博義"],
    "群馬4区": ["伊藤達也","青木ひとみ","福田達夫","山田博規"],
    "群馬5区": ["小渕優子","木暮智貴"],
    "埼玉1区": ["村井英樹","菅又士廊","武正公一","羽田一樹"],
    "埼玉2区": ["菅野静華","高橋英明","新藤義孝","細谷勇人"],
    "埼玉3区": ["中村尚子","黄川田仁志","竹内千春"],
    "埼玉4区": ["岸田光広","工藤薫","穂坂泰","伊勢田享子"],
    "埼玉5区": ["枝野幸男","飯塚佳佑","井原隆"],
    "埼玉6区": ["長島美子","大島敦","津田賢伯","尾花瑛仁","秋山もえ"],
    "埼玉7区": ["小宮山泰子","中野英幸"],
    "埼玉8区": ["市来伴子","柴山昌彦","岡田静佳"],
    "埼玉9区": ["杉村慎治","大塚拓"],
    "埼玉10区": ["坂本祐之輔","山口晋"],
    "埼玉11区": ["小泉龍司","島田誠","甲斐隆","柿沼遥輝","布施卓人"],
    "埼玉12区": ["森田俊和","野中厚"],
    "埼玉13区": ["三ツ林裕巳","杉山鎮夫","橋本幹彦","沢口千枝子","高井崇志"],
    "埼玉14区": ["苗村京子","雨宮裕子","藤田誠","鈴木義弘"],
    "埼玉15区": ["田中良生","藤川広明","南原竜樹","小山田経子"],
    "埼玉16区": ["土屋品子","永堀健","三角創太"],
    "東京1区": ["山田美樹","海江田万里","吉川里奈","春山明日香","黒田朝陽"],
    "東京2区": ["天野こころ","海江田悠輔","鳩山紀一郎","細野真理","土橋章宏","辻清人","今村充"],
    "東京3区": ["石崎徹","石田慎吾","阿部祐美子","植木洋貴","石原宏高"],
    "東京4区": ["井戸正枝","嶋悦子","平将明","谷川智行"],
    "東京5区": ["稲葉太郎","桑水流弓紀子","手塚仁雄","若宮健嗣","松岡登志子"],
    "東京6区": ["落合貴之","丸山勝己","島村直輝","畦元将吾","福村康広"],
    "東京7区": ["峰島侑也","丸川珠代","渡辺泰之","松尾明弘","石川友梨香","入江伸子"],
    "東京8区": ["森田一成","門寛子","永井漠","吉田晴美","海保杜久麻","大谷司郎","藤原幸弘"],
    "東京9区": ["鈴木文哉","薬師寺道代","菅原一秀","山岸一生"],
    "東京10区": ["鈴木隼人","梶原みずほ","小山徹","鈴木庸介","安田伸"],
    "東京11区": ["大豆生田実","松方恵美","阿久津幸彦","桑島康文","高沢一基","下村博文","横手海人"],
    "東京12区": ["阿部司","久住勇樹","黒石裕子","田原聖子","高木啓","中原翔太"],
    "東京13区": ["加地敏子","土田慎","沢田真吾","森洋介"],
    "東京14区": ["長南貴則","丹悠","原努","松島みどり","櫛渕万里"],
    "東京15区": ["酒井菜摘","鈴木佳奈","三次由梨香","深見紗采","大空幸星","吉野敏明"],
    "東京16区": ["竹内知子","村上剛","柴田勝之","大西洋平"],
    "東京17区": ["反田麻理","平沢勝栄","長谷川貴子","円より子","杉浦慎一郎","鈴木真志","猪口幸子"],
    "東京18区": ["徳永由紀子","松下玲子","福田かおる","吉田綾","鈴木佑馬"],
    "東京19区": ["諏訪玲子","末松義規","松本洋平","一ノ瀬陽子","井手重美津子"],
    "東京20区": ["木原誠二","大西健太郎","宮本徹","掛山茂希"],
    "東京21区": ["黒田太郎","鈴木烈","星野奈美","小田原潔","矢田一久"],
    "東京22区": ["山花郁夫","伊藤達也","鈴木美香"],
    "東京23区": ["川松真一朗","伊藤俊輔","池川友一","舟見裕貴"],
    "東京24区": ["細屋椋","與倉さゆり","深田萌絵","萩生田光一","細貝悠"],
    "東京25区": ["依田花蓮","木村奈美","宗像久敬","井上信治","宮﨑太朗"],
    "東京26区": ["松井佳苗子","坂元悠紀","松原仁","宇佐美登","今岡植","菅沼桂子"],
    "東京27区": ["長妻昭","小笠原愛子","黒崎祐一","須山卓知"],
    "東京28区": ["村松一希","橋口奈保","安藤高夫","高野直美","高松智之","三沢宏明"],
    "東京29区": ["堀川哲郎","木村剛司","鈴木賢一","長沢興祐","樽井良和","小坂英二"],
    "東京30区": ["寿玲子","五十嵐衣里","川上竜世","長島昭久"],
    "千葉1区": ["上田敦広","門山宏哲","田嶋要"],
    "千葉2区": ["小林鷹之","白石ちよ","佐藤由美"],
    "千葉3区": ["渡部公美子","山本政幸","松野博一","岡島一正"],
    "千葉4区": ["玉堀里衣","鹿嶋祐介","水沼秀幸","工藤聖子","高橋宏"],
    "千葉5区": ["小林修平","英利アルフィヤ","宮路純一","矢崎堅太郎","岡野純子"],
    "千葉6区": ["武藤雄大","出羽幹子","安藤淳子","浦野真","渡辺博道"],
    "千葉7区": ["斎藤健","林田章裕","川田龍平"],
    "千葉8区": ["宮本寛之","石塚貞通","松本泉","本庄知史"],
    "千葉9区": ["田宮寿人","奥野総一郎","前田裕介","田沼隆志"],
    "千葉10区": ["田村理江","谷田川元","小池正昭"],
    "千葉11区": ["椎名史明","森英介","多ケ谷亮"],
    "千葉12区": ["葛原茂","浜田靖一","大薄裕也"],
    "千葉13区": ["宮川伸","松本尚","中谷めぐみ"],
    "千葉14区": ["中村愛","野田佳彦","八鎌健太","長野春信"],
    "神奈川1区": ["篠原豪","丸尾南都子","浅川義治"],
    "神奈川2区": ["柳家東三楼","新田章文","平本幸次郎","並木まり子","片山智絵"],
    "神奈川3区": ["横山征吾","中村武人","二宮研","荻野ミエ","中西健治"],
    "神奈川4区": ["早稲田夕季","田宮零一郎","永田磨梨奈"],
    "神奈川5区": ["久坂くにえ","山崎誠","高宮美智子","坂井学"],
    "神奈川6区": ["古川直季","青柳陽一郎"],
    "神奈川7区": ["鈴木馨祐","中谷一馬"],
    "神奈川8区": ["江田憲司","三谷英弘"],
    "神奈川9区": ["笠浩史","赤石博子","上原正裕"],
    "神奈川10区": ["田中和徳","中野智裕","山口翔平","橋本公夫","金村龍那"],
    "神奈川11区": ["小泉進次郎","前林恒平","為壮稔"],
    "神奈川12区": ["阿部知子","沼上常生","星野剛士","菊竹進"],
    "神奈川13区": ["太栄志","丸田康一郎","石井匡"],
    "神奈川14区": ["先沖仁志","赤間二郎","中村圭","長友克洋"],
    "神奈川15区": ["河野太郎","小山善光","三好諒","佐々木克己"],
    "神奈川16区": ["後藤祐一","佐藤主迪"],
    "神奈川17区": ["中村太一","牧島かれん","佐々木奈保美"],
    "神奈川18区": ["山際大志郎","西岡義高","宗野創","八巻陽子","藤田修一","横田光弘"],
    "神奈川19区": ["深作ヘスス","室井一真","草間剛","添田勝"],
    "神奈川20区": ["金子洋一","金沢結衣","大塚小百合"],
    "山梨1区": ["中島克仁","鈴木大介","田中星那","中谷真一"],
    "山梨2区": ["早田記史","堀内詔子"],
    "新潟1区": ["西村智奈美","内山航","小池幸夫","伊藤和成","中村岳夫"],
    "新潟2区": ["平井恵里子","金井典子","国定勇人","菊田真紀子"],
    "新潟3区": ["佐久間慶子","黒岩宇洋","斎藤洋明"],
    "新潟4区": ["鷲尾英一郎","米山隆一","野村泰暉","大矢寿乃"],
    "新潟5区": ["梅谷守","高野直行","高鳥修一"],
    "富山1区": ["青山了介","中田宏","山登志浩","斉藤匠"],
    "富山2区": ["越川康晴","上田英俊"],
    "富山3区": ["山本圭太","坂本洋史","橘慶一郎","直原美和子"],
    "石川1区": ["小森卓郎","小竹凱","小林誠","川裕一郎","村田茂"],
    "石川2区": ["佐々木紀","坂本浩"],
    "石川3区": ["西田昭二","南章治","近藤和也"],
    "福井1区": ["山中俊祐","藤本一希","稲田朋美","波多野翼"],
    "福井2区": ["斉木武志","辻英之"],
    "長野1区": ["若狭清史","篠原孝","若林健太"],
    "長野2区": ["手塚大輔","下条みつ","竹下博善","藤田ひかる"],
    "長野3区": ["山口孝司","井出庸生","仁科裕貴","神津健"],
    "長野4区": ["武田良介","後藤茂之","花岡明久"],
    "長野5区": ["宮下一郎","福田淳太"],
    "岐阜1区": ["服部学","野田聖子","波多野純子","成井まゆ子"],
    "岐阜2区": ["棚橋泰文","伊藤あゆみ","塚原雅也","唐沢理恵","野村美穂"],
    "岐阜3区": ["武藤容治","仙田晃宏","阪口直人","伊藤恵介"],
    "岐阜4区": ["今井雅人","曽我雄介","加藤大博"],
    "岐阜5区": ["真野哲","吉田企貴","古屋圭司","山田良司"],
    "静岡1区": ["鈴木節子","柴田将平","上川陽子"],
    "静岡2区": ["鈴木岳幸","井林辰憲"],
    "静岡3区": ["山本裕三","中橋辰也","竹村真弓","小山展弘"],
    "静岡4区": ["深沢陽一","鈴木智","高田晃宏","田中健"],
    "静岡5区": ["中村正善","細野豪志","下山一美"],
    "静岡6区": ["輦止保教","勝俣孝明","渡辺周"],
    "静岡7区": ["北野谷富子","袴田サヤカ","城内実"],
    "静岡8区": ["稲葉大輔","村田優哉","神田綾乃","源馬謙太郎"],
    "愛知1区": ["熊田裕通","吉田統彦","河村たかし","近田茜"],
    "愛知2区": ["酒井健太朗","辻秀樹","梅村忠司","古川元久"],
    "愛知3区": ["柴田民雄","水野良彦","皆川雅一","平岩征樹","近藤昭一"],
    "愛知4区": ["志村康博","高橋祐介","中田千代","牧義夫","工藤彰三","魚住佳奈"],
    "愛知5区": ["神田憲次","田中克和","渡辺藍理","岡本康宏","西川厚志","江上博之"],
    "愛知6区": ["大西雅人","橋本勉","国崎信江","春日舞","丹羽秀樹"],
    "愛知7区": ["鈴木弘一","鈴木淳司","日野紗里亜"],
    "愛知8区": ["伴野豊","伊藤忠彦","中川健一"],
    "愛知9区": ["浦上奈々","伊藤恵子","長坂康正","岡本充功","加藤泰稚"],
    "愛知10区": ["若山慎司","杉本和巳","三嶋竜平","山内遼平","藤原規真"],
    "愛知11区": ["丹野みどり","藤沢忠盛"],
    "愛知12区": ["重徳和彦","青山周平","中川博登"],
    "愛知13区": ["大西健介","牛田清博","石井拓"],
    "愛知14区": ["浅尾大輔","大嶽理恵","今枝宗一郎"],
    "愛知15区": ["関健一郎","小山千帆","根本幸典","鈴木勝裕","辻恵","竹上裕子"],
    "愛知16区": ["渡辺信江","前田雄吉","山下史守朗","松田功","福田徹"],
    "三重1区": ["田村憲久","出口洋介","福森和歌子"],
    "三重2区": ["水谷幸泰","下野幸助","川崎秀人"],
    "三重3区": ["岡田克也","新谷恵","衣笠民子","伊藤昌志","石原正敬"],
    "三重4区": ["鈴木英敬","藤田大助","中川民英"],
    "滋賀1区": ["黄野瀬明子","大岡敏孝","斎藤アレックス","河井昭成"],
    "滋賀2区": ["岡屋京佑","上野賢一郎","平尾道雄"],
    "滋賀3区": ["伊吹裕","北野裕子","早智敬","安持成美","出路真吾","武村展英"],
    "京都1区": ["堀場幸子","勝目康","平竹耕三","谷口青人","桂隆俊","鎌野敏徳","佐々木隆吏","浜田聡"],
    "京都2区": ["藤田洋司","辻村千尋","堀川朗子","河野有里子","酒井勇輔","前原誠司"],
    "京都3区": ["樋口智","木村元紀","西山頌秀","繁本護","泉健太"],
    "京都4区": ["吉田幸一","北神圭朗"],
    "京都5区": ["本田太郎","山内健"],
    "京都6区": ["大奈","山井和則","上條亮一","園崎弘道"],
    "大阪1区": ["井上英孝","竹内祥倫","中村由紀","塩野智郎","大西宏幸"],
    "大阪2区": ["小川陽太","石橋篤史","守島正","高見亮"],
    "大阪3区": ["柳本顕","東徹","渡部結","山室貴史","宇都宮優子"],
    "大阪4区": ["中山泰秀","橋口和矢","藤田美季","岡本忠志","山田みのり","美延映夫"],
    "大阪5区": ["梅村聡","大石晃子","前田英倫","松山恵子","湊隆介","杉田水脈"],
    "大阪6区": ["亀井淳","西田薫","月足舞子","永井正史","阪本洋三"],
    "大阪7区": ["川添健真","石川勝","奥下剛光","渡嘉敷奈緒美"],
    "大阪8区": ["平川節代","高麗啓一郎","佐藤潤","漆間譲司","榊原美礼"],
    "大阪9区": ["西尾慧吾","萩原佳","東田淳平"],
    "大阪10区": ["池下卓","尾辻かな子","加納陽之助","井上誠也"],
    "大阪11区": ["山岡智美","村上賀厚","松本直高","中司宏","北尾学"],
    "大阪12区": ["太田徹","藤田文武","樽床伸二","北川晋平"],
    "大阪13区": ["宗清皇一","宝井晃美","八幡愛","本多平直","岩谷良平","立岡昭是"],
    "大阪14区": ["内藤耕一","尾立源幸","青柳仁士"],
    "大阪15区": ["島田智明","平山貴士","浦野靖人"],
    "大阪16区": ["葉田治央","黒田征樹","森山浩行","池上和日子"],
    "大阪17区": ["井上光吉","東本和美","信貴麻美","馬場伸幸"],
    "大阪18区": ["馬場英樹","内田隆嗣","遠藤敬"],
    "大阪19区": ["谷川とむ","北村みき","松岡能礼","小羽根正代","伊東信久"],
    "兵庫1区": ["藤末浩美","原弥彦","井坂信彦","盛山正仁","一谷勇一郎"],
    "兵庫2区": ["井村弘子","船川治郎","阿部圭史","坊恭寿"],
    "兵庫3区": ["向山好一","加藤健二","関芳弘","和田有一朗"],
    "兵庫4区": ["日比優子","中山高志","藤井比早之"],
    "兵庫5区": ["遠藤良太","谷公一","川戸康嗣","村岡峰男","高橋秀彰"],
    "兵庫6区": ["谷浩一郎","吉見秋彦","市村浩一郎","大串正樹","桜井周"],
    "兵庫7区": ["山田賢司","酒井遼","平野貞雄","岡田悟","三木圭恵"],
    "兵庫8区": ["青山繁晴","弘川欣絵","板東正恵","徳安淳子","長谷川羽衣子"],
    "兵庫9区": ["山寺崇仁","西村康稔","橋本慧悟","伊藤和貴"],
    "兵庫10区": ["渡海紀三朗","藤原誠也","奥田芙美代","隠樹圭子","掘井健智"],
    "兵庫11区": ["苦瓜一成","山下聖","住吉寛紀","中原立貴","山田基靖"],
    "兵庫12区": ["池畑浩太朗","山口壮","太田清幸"],
    "奈良1区": ["小林茂樹","谷川和広","馬淵澄夫","黒川洋司","杉本葵"],
    "奈良2区": ["高市早苗","池田英子"],
    "奈良3区": ["太田敦","原山大亮","八木宏昌","田野瀬太道"],
    "和歌山1区": ["山本大地","林元政子","前久","要友紀子","林佑美","浦平美博","正司武"],
    "和歌山2区": ["世耕弘成","畑野良弘"],
    "鳥取1区": ["塚田成幸","豊哲也","谷川裕美","石破茂"],
    "鳥取2区": ["福住英行","湯原俊二","赤沢亮正"],
    "島根1区": ["亀井亜紀子","伊藤礼司","村穂江利子","高階恵美子"],
    "島根2区": ["倉井克幸","大塚聡子","高見康裕","亀谷優子"],
    "岡山1区": ["山本安音","住寄聡美","原紘志","原田謙介","逢沢一郎"],
    "岡山2区": ["山下貴司","余江雪央","津村啓介","徳永多真美"],
    "岡山3区": ["加藤勝信","原田亜希子"],
    "岡山4区": ["橋本岳","柚木道義","三宅沙侑美","垣内雄一"],
    "広島1区": ["山田肇","産原稔文","川田海栄","中原剛","岸田文雄","黒木貞彦","楾大樹"],
    "広島2区": ["平口洋","佐藤由紀子","福田玄","岡田博美"],
    "広島3区": ["玉田憲勲","東克哉","田中淳子","石橋林太郎","高松史子"],
    "広島4区": ["新谷正義","空本誠喜","鍋島勢理"],
    "広島5区": ["山本深","佐藤公治","猪原真弓"],
    "広島6区": ["高木武志","小林史明","はたともこ"],
    "山口1区": ["山﨑珠江","野田陽志","高村正大"],
    "山口2区": ["平岡秀夫","岸信千世"],
    "山口3区": ["林芳正","篠田知宏","伊藤博文","吹上政子","島村薫"],
    "徳島1区": ["吉田知代","仁木博文","高橋永","亀井千春"],
    "徳島2区": ["山口俊一","浜共生","飯泉嘉門","北島一人"],
    "香川1区": ["小川淳也","平井卓也","道川和樹","長尾真希"],
    "香川2区": ["玉木雄一郎","瀬戸隆一","秋山友理子"],
    "香川3区": ["川崎智光","大野敬太郎","細川修平"],
    "愛媛1区": ["篠藤愛","塩崎彰久","和田宰","石井智恵"],
    "愛媛2区": ["井原巧","原田慎太郎","白石洋一"],
    "愛媛3区": ["長谷川淳二","萩原旭人","西井直人"],
    "高知1区": ["金城幹泰","中谷元","田所裕介"],
    "高知2区": ["浜川百合子","尾﨑正直","前田強"],
    "福岡1区": ["井上貴博","岩本義孝","山本剛正","丸尾圭祐","吉富景子"],
    "福岡2区": ["貫洞基裕","鬼木誠","稲富修二","木下敏之"],
    "福岡3区": ["原賀瞳","仁戸田元気","古賀篤","天野浩"],
    "福岡4区": ["許斐亮太郎","原田祐一","宮内秀樹"],
    "福岡5区": ["川元健一","岡部吉高","栗原渉","那須敬子"],
    "福岡6区": ["近藤雅彦","鳩山二郎","河野一弘"],
    "福岡7区": ["藤丸敏","亀田晃尚"],
    "福岡8区": ["麻生太郎","森田俊文","沖園理恵"],
    "福岡9区": ["山田博敏","三原朝利","大塚弘尊","緒方林太郎"],
    "福岡10区": ["大石仁人","熊本要","城井崇","古賀邦俊","吉村悠"],
    "福岡11区": ["辻智之","武田良太","志岐玲子","井上直生","村上智信"],
    "佐賀1区": ["原口一博","重松貴美","岩田和親"],
    "佐賀2区": ["古川康","大串博志"],
    "長崎1区": ["内田隆英","松石宗平","浅田眞澄美","山田博司","西岡秀子"],
    "長崎2区": ["山田勝彦","高木聡子","加藤竜祥"],
    "長崎3区": ["金子容三","田崎耕太"],
    "熊本1区": ["山口誠太郎","木原稔","鎌田聡"],
    "熊本2区": ["益田牧子","西野太亮","前田智徳"],
    "熊本3区": ["坂本哲志","橋村りか","霍田和佳"],
    "熊本4区": ["上田至","矢上雅義","植田貴俊","本村久美子","金子恭之"],
    "大分1区": ["堤淳太","衛藤博昭","野中しんすけ","吉良州司","山下魁"],
    "大分2区": ["広瀬建","吉川元"],
    "大分3区": ["野中貴恵","岩屋毅","小林華弥子","平野雨龍","岩永京子"],
    "宮崎1区": ["横田朋大","滋井邦晃","武井俊輔","渡辺創"],
    "宮崎2区": ["白江好友","江藤拓","長友慎治"],
    "宮崎3区": ["高瀬大介","古川禎久"],
    "鹿児島1区": ["宮路拓馬","牧野俊一","小山慎之介","川内博史"],
    "鹿児島2区": ["高橋徳美","松崎真琴","三反園訓"],
    "鹿児島3区": ["野間健","小里泰弘"],
    "鹿児島4区": ["桐原郁生","中村寿","伊藤周平","森山裕"],
    "沖縄1区": ["山川泰博","和田知久","赤嶺政賢","国場幸之助","中島万穂"],
    "沖縄2区": ["瑞慶覧長敏","新垣邦男","宮崎政久","吉田悠里","比嘉隆"],
    "沖縄3区": ["仲間暁子","島尻安伊子","屋良朝博"],
    "沖縄4区": ["崎枝裕次","西銘恒三郎","砥板芳行","山川仁"]
};


    // Old CANDIDATES constant for backward compatibility
    const CANDIDATES = [
        { id: 'uesugi', name: '上杉 謙太郎', party: '自由民主党', status: '元職' },
        { id: 'kanayama', name: '金山 屯', party: '無所属', status: '新人' },
        { id: 'oguma', name: '小熊 慎司', party: '中道改革連合', status: '前職' }
    ];

    // Pre-election seat data (PARTIESから自動生成)
    const PRE_ELECTION_SEATS = PARTIES.map(p => ({ id: p.id, name: p.name, seats: p.preSeats, color: p.color }));

    let db = null;
    let pendingPrediction = null;

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
        initFirebase();
        initUI();
        initRefBars();
        checkAdminAccess();
        checkDeadlineAndUpdateUI();
    });

    // URLパラメータで管理者アクセスをチェック
    function checkAdminAccess() {
        const params = new URLSearchParams(window.location.search);
        // URLに ?admin=なんでも があれば管理者タブを表示
        if (params.has('admin')) {
            document.getElementById('admin-tab-li').style.display = '';
        }
    }

    function initFirebase() {
        if (FIREBASE_CONFIG.apiKey === "YOUR_API_KEY") {
            console.warn("Firebaseが設定されていません。オフラインモードで動作します。");
            return;
        }
        try {
            firebase.initializeApp(FIREBASE_CONFIG);
            db = firebase.database();
            console.log("Firebase connected");
        } catch (e) {
            console.error("Firebase init error:", e);
        }
    }

    function initUI() {
        // Party inputs
        document.getElementById('party-inputs').innerHTML = PARTIES.map(p => `
            <div class="party-item" style="border-left-color:${p.color}">
                <span class="name">${p.name}（${p.preSeats}）</span>
                <input type="number" id="party-${p.id}" value="0" min="0" max="465" oninput="updateSeats()">
            </div>
        `).join('');

        // Quiz inputs
        document.getElementById('quiz-inputs').innerHTML = QUIZZES.map((q, i) => `
            <div class="quiz-item">
                <div class="quiz-question"><strong>Q${i+1}.</strong> ${q.q}</div>
                <div class="quiz-options">
                    <button class="quiz-btn" onclick="selectQuiz('${q.id}','yes',this)">はい</button>
                    <button class="quiz-btn" onclick="selectQuiz('${q.id}','no',this)">いいえ</button>
                </div>
                <input type="hidden" id="quiz-${q.id}" value="">
            </div>
        `).join('');

        // Local prefecture dropdown
        const prefSelect = document.getElementById('local-pref');
        DISTRICTS.forEach(d => {
            const opt = document.createElement('option');
            opt.value = d.pref;
            opt.textContent = d.pref;
            prefSelect.appendChild(opt);
        });



        // Admin inputs
        document.getElementById('admin-party-inputs').innerHTML = PARTIES.map(p => `
            <div class="party-item" style="border-left-color:${p.color}">
                <span class="name" style="font-size:13px">${p.name}（${p.preSeats}）</span>
                <input type="number" id="admin-${p.id}" value="0" min="0" max="465" oninput="updateAdminTotal()">
            </div>
        `).join('');

        document.getElementById('admin-quiz-inputs').innerHTML = QUIZZES.map((q, i) => `
            <div class="quiz-item">
                <div class="quiz-question"><strong>Q${i+1}.</strong> ${q.q}</div>
                <div class="quiz-options">
                    <button class="quiz-btn" onclick="selectAdminQuiz('${q.id}','yes',this)">はい</button>
                    <button class="quiz-btn" onclick="selectAdminQuiz('${q.id}','no',this)">いいえ</button>
                </div>
                <input type="hidden" id="admin-quiz-${q.id}" value="">
            </div>
        `).join('');
    }

    // Reference bars
    function initRefBars() {
        const maxSeats = Math.max(...PRE_ELECTION_SEATS.map(p => p.seats));
        const container = document.getElementById('ref-bars');
        if (!container) return;

        container.innerHTML = PRE_ELECTION_SEATS.map(p => {
            const pct = (p.seats / 465) * 100;
            const showInside = p.seats >= 15;
            return `
                <div class="ref-bar-row">
                    <span class="ref-bar-label">${p.name}</span>
                    <div class="ref-bar-track">
                        <div class="ref-bar-fill" style="width:${pct}%;background:${p.color}">
                            ${showInside ? `<span class="ref-bar-value">${p.seats}</span>` : ''}
                        </div>
                    </div>
                    ${!showInside ? `<span class="ref-bar-value-out">${p.seats}</span>` : '<span class="ref-bar-value-out"></span>'}
                </div>
            `;
        }).join('') + `
            <div class="ref-total-row">
                <span class="label">定数</span>
                <span class="value">465（過半数 233）</span>
            </div>
        `;
    }

    function toggleRef() {
        const body = document.getElementById('ref-body');
        const icon = document.getElementById('ref-toggle');
        body.classList.toggle('collapsed');
        icon.classList.toggle('open');
    }

    // Tab Navigation
    function showTab(tab) {
        document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
        document.getElementById(`panel-${tab}`).classList.add('active');
        document.getElementById(`tab-${tab}`).classList.add('active');

        if (tab === 'participants') loadParticipants();
        if (tab === 'results') loadResults();
    }


    // Prediction Form
    function selectQuiz(id, value, btn) {
        document.getElementById(`quiz-${id}`).value = value;
        btn.parentElement.querySelectorAll('.quiz-btn').forEach(b => b.classList.remove('selected-yes', 'selected-no'));
        btn.classList.add(value === 'yes' ? 'selected-yes' : 'selected-no');
    }

    function updateDistrictOptions() {
        const pref = document.getElementById('local-pref').value;
        const distSelect = document.getElementById('local-district');
        distSelect.innerHTML = '<option value="">選択してください</option>';
        if (!pref) return;
        const d = DISTRICTS.find(x => x.pref === pref);
        if (!d) return;
        for (let i = 1; i <= d.count; i++) {
            const opt = document.createElement('option');
            opt.value = `${pref}${i}区`;
            opt.textContent = `${pref}${i}区`;
            distSelect.appendChild(opt);
        }
        updateCandidateOptions();
    }

    function updateCandidateOptions() {
        const district = document.getElementById('local-district').value;
        const candSelect = document.getElementById('local-candidate-name');
        candSelect.innerHTML = '<option value="">選択してください</option>';
        if (!district || !CANDIDATES_DATA[district]) return;
        CANDIDATES_DATA[district].forEach(name => {
            const opt = document.createElement('option');
            opt.value = name;
            opt.textContent = name;
            candSelect.appendChild(opt);
        });
    }

    // ============================================
    // Geolocation: 現在地から選挙区を自動設定
    // ============================================
    function detectLocation() {
        const btn = document.getElementById('geo-btn');
        const status = document.getElementById('geo-status');

        if (!navigator.geolocation) {
            showGeoStatus('error', 'お使いのブラウザは位置情報に対応していません。');
            return;
        }

        btn.disabled = true;
        btn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="animation:spin 1s linear infinite"><circle cx="12" cy="12" r="3"/><path d="M12 2v4M12 18v4M2 12h4M18 12h4"/><circle cx="12" cy="12" r="9"/></svg> 位置情報を取得中...';

        navigator.geolocation.getCurrentPosition(
            pos => reverseGeocode(pos.coords.latitude, pos.coords.longitude),
            err => {
                let msg = '位置情報を取得できませんでした。';
                if (err.code === 1) msg = '位置情報の使用が許可されませんでした。ブラウザの設定をご確認ください。';
                else if (err.code === 2) msg = '位置情報が利用できません。';
                else if (err.code === 3) msg = '位置情報の取得がタイムアウトしました。';
                showGeoStatus('error', msg);
                resetGeoBtn();
            },
            { enableHighAccuracy: true, timeout: 10000, maximumAge: 300000 }
        );
    }

    function reverseGeocode(lat, lon) {
        const url = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=10&addressdetails=1&accept-language=ja`;
        fetch(url, { headers: { 'User-Agent': 'ElectionPredictionGame/1.0' } })
            .then(r => r.json())
            .then(data => {
                const addr = data.address || {};
                // Nominatimは state に都道府県名を返す
                let pref = addr.province || addr.state || '';
                // 「県」「府」「都」「道」を含む正式名から DISTRICTS のpref名に変換
                const prefMatch = DISTRICTS.find(d => pref.includes(d.pref));
                if (prefMatch) {
                    const prefSelect = document.getElementById('local-pref');
                    prefSelect.value = prefMatch.pref;
                    updateDistrictOptions();

                    // 選挙区が1つの場合は自動選択
                    if (prefMatch.count === 1) {
                        document.getElementById('local-district').value = `${prefMatch.pref}1区`;
                        updateCandidateOptions();
                        showGeoStatus('success', `${prefMatch.pref}（${prefMatch.pref}1区）に設定しました。`);
                    } else {
                        showGeoStatus('success', `${prefMatch.pref}（全${prefMatch.count}区）を検出しました。選挙区を選択してください。`);
                    }
                } else {
                    showGeoStatus('error', `都道府県を特定できませんでした（${pref || '不明'}）。手動で選択してください。`);
                }
                resetGeoBtn();
            })
            .catch(err => {
                showGeoStatus('error', '逆ジオコーディングに失敗しました。手動で選択してください。');
                resetGeoBtn();
            });
    }

    function showGeoStatus(type, message) {
        const status = document.getElementById('geo-status');
        status.style.display = 'block';
        if (type === 'success') {
            status.style.background = '#e8f5e9';
            status.style.color = '#2e7d32';
            status.style.border = '1px solid #a5d6a7';
        } else {
            status.style.background = '#fce4ec';
            status.style.color = '#c62828';
            status.style.border = '1px solid #ef9a9a';
        }
        status.textContent = message;
        // 成功メッセージは5秒後に自動非表示
        if (type === 'success') {
            setTimeout(() => { status.style.display = 'none'; }, 5000);
        }
    }

    function resetGeoBtn() {
        const btn = document.getElementById('geo-btn');
        btn.disabled = false;
        btn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M12 2v4M12 18v4M2 12h4M18 12h4"/><circle cx="12" cy="12" r="9"/></svg> 現在地から選挙区を設定';
    }

    function updateSeats() {
        let total = 0;
        PARTIES.forEach(p => { total += parseInt(document.getElementById(`party-${p.id}`).value) || 0; });

        document.getElementById('total-seats').textContent = total;
        const status = document.getElementById('seats-status');

        if (total === 465) {
            status.textContent = 'OK';
            status.className = 'status status-ok';
        } else if (total < 465) {
            status.textContent = `あと${465 - total}`;
            status.className = 'status status-warning';
        } else {
            status.textContent = `${total - 465}超過`;
            status.className = 'status status-error';
        }

        // Pitari
        let max = 0, maxP = null;
        PARTIES.forEach(p => {
            const v = parseInt(document.getElementById(`party-${p.id}`).value) || 0;
            if (v > max) { max = v; maxP = p; }
        });
        document.getElementById('pitari-party').textContent = maxP ? maxP.name : '-';
        document.getElementById('pitari-seats').textContent = max || '-';
    }

    // 回答締切: 2026年2月9日 18:00 JST
    const SUBMISSION_DEADLINE = new Date('2026-02-09T18:00:00+09:00');

    function isDeadlinePassed() {
        return new Date() > SUBMISSION_DEADLINE;
    }

    function checkDeadlineAndUpdateUI() {
        if (isDeadlinePassed()) {
            const btn = document.getElementById('submit-btn');
            if (btn) {
                btn.disabled = true;
                btn.textContent = '回答受付は終了しました';
                btn.style.opacity = '0.5';
                btn.style.cursor = 'not-allowed';
            }
            // 締切メッセージを表示
            let msg = document.getElementById('deadline-message');
            if (!msg) {
                msg = document.createElement('div');
                msg.id = 'deadline-message';
                msg.style.cssText = 'background:#fee;border:1px solid #c00;color:#c00;padding:12px 16px;border-radius:8px;margin-bottom:16px;text-align:center;font-weight:bold;';
                msg.textContent = '⏰ 回答の受付は2月9日 18:00に締め切りました';
                const submitDiv = btn?.parentElement;
                if (submitDiv) submitDiv.parentElement.insertBefore(msg, submitDiv);
            }
        }
    }

    // Confirmation
    function openConfirmModal() {
        // 締切チェック
        if (isDeadlinePassed()) {
            alert('回答の受付は2月9日 18:00に締め切りました。');
            checkDeadlineAndUpdateUI();
            return;
        }

        const name = document.getElementById('participant-name').value.trim();
        if (!name) return alert('参加者名を入力してください');

        let total = 0;
        const parties = {};
        PARTIES.forEach(p => {
            parties[p.id] = parseInt(document.getElementById(`party-${p.id}`).value) || 0;
            total += parties[p.id];
        });
        if (total !== 465) return alert(`議席数の合計を465にしてください（現在: ${total}）`);

        const quizzes = {};
        for (const q of QUIZZES) {
            const v = document.getElementById(`quiz-${q.id}`).value;
            if (!v) return alert('すべてのクイズに回答してください');
            quizzes[q.id] = v;
        }

        const localDistrict = document.getElementById('local-district').value;
        if (!localDistrict) return alert('地元の選挙区を選択してください');
        const localCandidateName = document.getElementById('local-candidate-name').value.trim();
        if (!localCandidateName) return alert('当選予測の候補者名を選択してください');

        pendingPrediction = { name, parties, quizzes, localDistrict, localCandidateName };

        // Build confirmation content
        let max = 0, firstParty = '';
        PARTIES.forEach(p => { if (parties[p.id] > max) { max = parties[p.id]; firstParty = p.id; } });

        let html = `
            <div class="detail-section">
                <div class="detail-title">参加者名</div>
                <p><strong>${name}</strong></p>
            </div>
            <div class="detail-section">
                <div class="detail-title">議席予測</div>
                <div class="detail-grid">
                    ${PARTIES.map(p => `
                        <div class="detail-item">
                            <span class="detail-label">${p.name}</span>
                            <span class="detail-value">${parties[p.id]}</span>
                        </div>
                    `).join('')}
                </div>
            </div>
            <div class="detail-section">
                <div class="detail-title">クイズ回答</div>
                ${QUIZZES.map((q, i) => `
                    <div class="detail-item">
                        <span class="detail-label">Q${i+1}</span>
                        <span class="detail-value">${quizzes[q.id] === 'yes' ? 'はい' : 'いいえ'}</span>
                    </div>
                `).join('')}
            </div>
            <div class="detail-section">
                <div class="detail-title">地元枠：${localDistrict}</div>
                <p><strong>${localCandidateName}</strong></p>
            </div>
            <div class="detail-section">
                <div class="detail-title">ピタリ賞予測</div>
                <p><strong>${PARTIES.find(p => p.id === firstParty)?.name}</strong> ${max}議席</p>
            </div>
        `;

        document.getElementById('confirm-body').innerHTML = html;
        document.getElementById('confirm-modal').classList.add('active');
    }

    function closeConfirmModal() {
        document.getElementById('confirm-modal').classList.remove('active');
    }

    async function confirmSubmit() {
        if (!pendingPrediction) return;

        // 締切チェック（二重チェック）
        if (isDeadlinePassed()) {
            alert('回答の受付は2月9日 18:00に締め切りました。');
            closeConfirmModal();
            checkDeadlineAndUpdateUI();
            return;
        }

        const data = {
            ...pendingPrediction,
            submittedAt: new Date().toISOString()
        };

        if (db) {
            try {
                await db.ref('predictions/' + data.name.replace(/[.#$[\]]/g, '_')).set(data);
                alert('予測を提出しました');
            } catch (e) {
                alert('エラー: ' + e.message);
                return;
            }
        } else {
            // Offline mode - save to localStorage
            const preds = JSON.parse(localStorage.getItem('predictions') || '{}');
            preds[data.name] = data;
            localStorage.setItem('predictions', JSON.stringify(preds));
            alert('予測を保存しました（オフラインモード）');
        }

        closeConfirmModal();
        pendingPrediction = null;
    }

    // Participants
    async function loadParticipants() {
        const container = document.getElementById('participants-list');
        container.innerHTML = '<div class="loading">読み込み中...</div>';

        let predictions = {};

        if (db) {
            try {
                const snapshot = await db.ref('predictions').once('value');
                predictions = snapshot.val() || {};
            } catch (e) {
                container.innerHTML = '<div class="empty-message">読み込みエラー</div>';
                return;
            }
        } else {
            predictions = JSON.parse(localStorage.getItem('predictions') || '{}');
        }

        const list = Object.values(predictions);

        if (list.length === 0) {
            container.innerHTML = '<div class="empty-message">まだ参加者がいません</div>';
            return;
        }

        container.innerHTML = list.map(p => {
            let max = 0, maxP = null;
            PARTIES.forEach(party => {
                if (p.parties[party.id] > max) { max = p.parties[party.id]; maxP = party; }
            });
            const time = new Date(p.submittedAt).toLocaleString('ja-JP');
            return `
                <div class="participant-item" onclick="showParticipantDetail('${p.name.replace(/'/g, "\\'")}')">
                    <div class="participant-name">${p.name}</div>
                    <div class="participant-time">${time}</div>
                    <div class="participant-summary">第一党予測: ${maxP?.name} (${max}議席) ／ 地元: ${p.localDistrict || '福島3区'}</div>
                </div>
            `;
        }).join('');
    }

    async function showParticipantDetail(name) {
        let predictions = {};
        if (db) {
            const snapshot = await db.ref('predictions').once('value');
            predictions = snapshot.val() || {};
        } else {
            predictions = JSON.parse(localStorage.getItem('predictions') || '{}');
        }

        const p = Object.values(predictions).find(x => x.name === name);
        if (!p) return;

        let max = 0, firstParty = '';
        PARTIES.forEach(party => { if (p.parties[party.id] > max) { max = p.parties[party.id]; firstParty = party.id; } });

        const html = `
            <div class="detail-section">
                <div class="detail-title">議席予測</div>
                <div class="detail-grid">
                    ${PARTIES.map(party => `
                        <div class="detail-item">
                            <span class="detail-label">${party.name}</span>
                            <span class="detail-value">${p.parties[party.id]}</span>
                        </div>
                    `).join('')}
                </div>
            </div>
            <div class="detail-section">
                <div class="detail-title">クイズ回答</div>
                ${QUIZZES.map((q, i) => `
                    <div class="detail-item">
                        <span class="detail-label">Q${i+1}. ${q.q}</span>
                        <span class="detail-value">${p.quizzes[q.id] === 'yes' ? 'はい' : 'いいえ'}</span>
                    </div>
                `).join('')}
            </div>
            <div class="detail-section">
                <div class="detail-title">地元枠：${p.localDistrict || '福島3区'}</div>
                <p><strong>${p.localCandidateName || CANDIDATES.find(c => c.id === p.localWinner)?.name || '-'}</strong></p>
            </div>
            <div class="detail-section">
                <div class="detail-title">ピタリ賞予測</div>
                <p><strong>${PARTIES.find(x => x.id === firstParty)?.name}</strong> ${max}議席</p>
            </div>
        `;

        document.getElementById('detail-name').textContent = p.name;
        document.getElementById('detail-body').innerHTML = html;
        document.getElementById('detail-modal').classList.add('active');
    }

    function closeDetailModal() {
        document.getElementById('detail-modal').classList.remove('active');
    }

    // Admin
    function selectAdminQuiz(id, value, btn) {
        document.getElementById(`admin-quiz-${id}`).value = value;
        btn.parentElement.querySelectorAll('.quiz-btn').forEach(b => b.classList.remove('selected-yes', 'selected-no'));
        btn.classList.add(value === 'yes' ? 'selected-yes' : 'selected-no');
    }

    function updateAdminTotal() {
        let total = 0;
        PARTIES.forEach(p => { total += parseInt(document.getElementById(`admin-${p.id}`).value) || 0; });
        document.getElementById('admin-total').textContent = total;
    }

    async function loadAdminLocalDistricts() {
        let predictions = {};
        if (db) {
            try {
                const snapshot = await db.ref('predictions').once('value');
                predictions = snapshot.val() || {};
            } catch (e) {
                alert('読み込みエラー');
                return;
            }
        } else {
            predictions = JSON.parse(localStorage.getItem('predictions') || '{}');
        }

        const preds = Object.values(predictions);
        const districts = [...new Set(preds.map(p => p.localDistrict).filter(Boolean))];

        const container = document.getElementById('admin-local-inputs');
        if (districts.length === 0) {
            container.innerHTML = '<p class="help-text">まだ予測を提出した参加者がいません</p>';
            return;
        }

        container.innerHTML = districts.map(dist => {
            const candidates = CANDIDATES_DATA[dist] || [];
            return `
                <div style="padding:12px;border:1px solid #ddd;margin-bottom:8px">
                    <div style="font-weight:700;margin-bottom:8px">${dist}</div>
                    <select id="admin-local-winner-${dist.replace(/[^a-zA-Z0-9\u3000-\u9fff]/g,'_')}" style="width:100%;padding:10px;border:1px solid #ccc;font-size:14px">
                        <option value="">当選者を選択</option>
                        ${candidates.map(c => `<option value="${c}">${c}</option>`).join('')}
                    </select>
                </div>
            `;
        }).join('');
    }

    async function saveResults() {
        const parties = {};
        let total = 0;
        PARTIES.forEach(p => {
            parties[p.id] = parseInt(document.getElementById(`admin-${p.id}`).value) || 0;
            total += parties[p.id];
        });
        if (total !== 465) return alert(`合計を465にしてください（現在: ${total}）`);

        const quizzes = {};
        for (const q of QUIZZES) {
            const v = document.getElementById(`admin-quiz-${q.id}`).value;
            if (!v) return alert('すべてのクイズの正解を入力してください');
            quizzes[q.id] = v;
        }

        // Collect local results
        const localInputs = document.querySelectorAll('#admin-local-inputs > div');
        const localResults = {};
        localInputs.forEach(div => {
            const distName = div.querySelector('div[style*="font-weight"]').textContent;
            const safeId = distName.replace(/[^a-zA-Z0-9\u3000-\u9fff]/g, '_');
            const winnerEl = document.getElementById('admin-local-winner-' + safeId);
            if (winnerEl && winnerEl.value) {
                localResults[distName] = { winner: winnerEl.value };
            }
        });

        const data = { parties, quizzes, localResults, savedAt: new Date().toISOString() };

        if (db) {
            try {
                await db.ref('actualResults').set(data);
                alert('結果を保存しました');
            } catch (e) {
                alert('エラー: ' + e.message);
                return;
            }
        } else {
            localStorage.setItem('actualResults', JSON.stringify(data));
            alert('結果を保存しました（オフラインモード）');
        }

        showTab('results');
    }

    // Results
    async function loadResults() {
        const container = document.getElementById('results-container');

        let predictions = {}, actual = null;

        if (db) {
            try {
                const [pSnap, rSnap] = await Promise.all([
                    db.ref('predictions').once('value'),
                    db.ref('actualResults').once('value')
                ]);
                predictions = pSnap.val() || {};
                actual = rSnap.val();
            } catch (e) {
                container.innerHTML = '<div class="empty-message">読み込みエラー</div>';
                return;
            }
        } else {
            predictions = JSON.parse(localStorage.getItem('predictions') || '{}');
            actual = JSON.parse(localStorage.getItem('actualResults') || 'null');
        }

        if (!actual) {
            container.innerHTML = '<div class="empty-message">開票結果が入力されるまでお待ちください</div>';
            return;
        }

        const preds = Object.values(predictions);
        if (preds.length === 0) {
            container.innerHTML = '<div class="empty-message">参加者がいません</div>';
            return;
        }

        // Calculate first party
        let maxA = 0, firstA = '';
        PARTIES.forEach(p => { if (actual.parties[p.id] > maxA) { maxA = actual.parties[p.id]; firstA = p.id; } });
        actual.firstParty = firstA;
        actual.firstPartySeats = maxA;

        // Score
        const scores = preds.map(p => calcScore(p, actual)).sort((a, b) => {
            if (b.total !== a.total) return b.total - a.total;
            return Math.abs(a.firstSeats - actual.firstPartySeats) - Math.abs(b.firstSeats - actual.firstPartySeats);
        });

        container.innerHTML = `
            <div class="result-summary">
                <h3>実際の選挙結果</h3>
                <div class="result-parties">
                    ${PARTIES.map(p => `
                        <div class="result-party">
                            <div class="name">${p.name.slice(0, 4)}</div>
                            <div class="seats">${actual.parties[p.id]}</div>
                        </div>
                    `).join('')}
                </div>
                <div style="margin-top:12px;font-size:14px">
                    第一党: ${PARTIES.find(p => p.id === firstA)?.name} (${maxA}議席)
                </div>
            </div>

            <section>
                <div class="section-header">ランキング</div>
                <div class="section-body">
                    ${scores.map((s, i) => {
                        let rankClass = '';
                        if (i === 0) rankClass = 'gold';
                        else if (i === 1) rankClass = 'silver';
                        else if (i === 2) rankClass = 'bronze';
                        else if (i === scores.length - 1) rankClass = 'last';

                        return `
                            <div class="ranking-item">
                                <div class="ranking-rank ${rankClass}">${i + 1}</div>
                                <div class="ranking-info">
                                    <div class="ranking-name">${s.name}</div>
                                    <div class="ranking-breakdown">
                                        議席${s.party}/60 ・ クイズ${s.quiz}/30 ・ 地元${s.local}/10
                                        ${s.pitari ? '・ ピタリ+20' : ''}
                                    </div>
                                </div>
                                <div class="ranking-score">${s.total}</div>
                            </div>
                        `;
                    }).join('')}
                </div>
            </section>
        `;
    }

    function calcScore(pred, actual) {
        let party = 0;
        PARTIES.forEach(p => {
            const diff = Math.abs((pred.parties[p.id] || 0) - (actual.parties[p.id] || 0));
            if (diff === 0) party += 5;
            else if (diff <= 5) party += 3;
            else if (diff <= 15) party += 1;
        });

        let quiz = 0;
        QUIZZES.forEach(q => { if (pred.quizzes[q.id] === actual.quizzes[q.id]) quiz += 5; });

        // Local scoring - check if the predicted candidate matches the actual winner
        let local = 0;
        if (pred.localDistrict && actual.localResults && actual.localResults[pred.localDistrict]) {
            const actualWinner = actual.localResults[pred.localDistrict].winner;
            if (pred.localCandidateName === actualWinner) {
                local = 10;
            }
        } else if (pred.localWinner && actual.localWinner) {
            // Backward compatibility with old format
            local = pred.localWinner === actual.localWinner ? 10 : 0;
        }

        let maxP = 0, firstP = '';
        PARTIES.forEach(p => { if (pred.parties[p.id] > maxP) { maxP = pred.parties[p.id]; firstP = p.id; } });
        const pitari = (firstP === actual.firstParty && maxP === actual.firstPartySeats) ? 20 : 0;

        return { name: pred.name, party, quiz, local, pitari, total: party + quiz + local + pitari, firstSeats: maxP };
    }
    </script>
</body>
</html>
